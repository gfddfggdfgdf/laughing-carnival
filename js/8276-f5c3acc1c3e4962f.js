!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="a4d5e7ee-8eea-4412-b1f8-242150dc3bca",e._sentryDebugIdIdentifier="sentry-dbid-a4d5e7ee-8eea-4412-b1f8-242150dc3bca")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8276],{5101:(e,t,a)=>{"use strict";a.d(t,{A:()=>D});var n=a(95155),s=a(28095),i=a(82882),r=a.n(i),o=a(52596),l=a(57141);function u(e){let{isOpen:t,onClose:a,children:i,topRightButton:u,buttons:d,title:c,showInnerBorders:g,noContentPadding:p,buttonsClassName:y,isLeftAlignedHeader:_,customClassName:m}=e;return(0,n.jsx)(s._s.Root,{shouldScaleBackground:!0,open:t,onClose:a,closeThreshold:.3,repositionInputs:!1,modal:!0,children:(0,n.jsxs)(s._s.Portal,{children:[(0,n.jsx)(s._s.Overlay,{className:(0,o.A)(r().overlay,l.f7),onClick:a}),(0,n.jsxs)(s._s.Content,{className:(0,o.A)(r().main,l.f7,m),children:[(0,n.jsx)("div",{className:r().handle}),(0,n.jsxs)("div",{className:(0,o.A)(_?r().left_aligned_header:r().header),style:{"--reserved-space":u?"96px":"24px"},children:[_&&(0,n.jsx)("span",{className:r().left_aligned_header_right}),(0,n.jsx)(s._s.Title,{className:r().title,children:c}),u]}),(0,n.jsx)("div",{className:(0,o.A)(r().content,{[r().border]:g,[r().nopadding]:p}),children:i}),d&&(0,n.jsx)("div",{className:(0,o.A)(r().buttons,y),children:d})]})]})})}var d=a(19407),c=a(90090),g=a(45084),p=a(97078),y=a.n(p),_=a(28150),m=a(12115);function h(e){let{isOpen:t,isPortal:a,onClose:s,topRightButton:i,buttons:r,title:l,children:u,showCloseButton:d=!0,showInnerBorders:g,noContentPadding:p,closeOnOutsideClick:h=!0,desktopClassName:f,buttonsClassName:b,hasAnimatePresence:Q=!0,isLeftAlignedHeader:D,customClassName:M}=e,w=(0,m.useRef)(null),x=(0,m.useRef)(!1),S=(0,m.useCallback)(e=>{e.target===w.current&&(x.current=!0)},[]),k=(0,m.useCallback)(e=>{h&&x.current&&e.target===w.current&&s(),x.current=!1},[s,h]);return(0,n.jsx)(v,{isPortal:a,hasAnimatePresence:Q,children:t&&(0,n.jsx)(c.P.div,{ref:w,className:y().overlay,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onMouseDown:S,onMouseUp:k,children:(0,n.jsxs)(c.P.div,{id:"open-modal",className:(0,o.A)(y().modal,{[y().modal_left_header]:D},M),onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)("div",{className:(0,o.A)(D?y().left_aligned_header:y().header),style:{"--reserved-space":i?"120px":"24px"},children:[i,(0,n.jsx)("span",{className:y().title,children:l}),d&&(0,n.jsx)(_.US,{width:20,height:20,onClick:s,className:y()["close-button"]})]}),(0,n.jsx)("div",{className:(0,o.A)(y().content,{[y().border]:g,[y().nopadding]:p},f),children:u}),r&&(0,n.jsx)("div",{className:(0,o.A)(y().buttons,b),children:r})]})})})}let v=e=>{let{hasAnimatePresence:t,isPortal:a,children:s}=e;return t?(0,n.jsx)(g.N,{initial:a,children:s}):(0,n.jsx)(n.Fragment,{children:s})};var f=a(84700),b=a.n(f),Q=a(81167);function D(e){let{isPortal:t=!0,isOpen:a,onClose:s}=e,i=(0,Q.Ub)(Q.$Z);(0,m.useEffect)(()=>{if(!a)return;let e=window.innerWidth-document.documentElement.clientWidth;document.body.style.marginRight=e+"px",document.body.style.overflow="hidden";let t=e=>{"Escape"===e.key&&s()};return document.addEventListener("keydown",t),()=>{document.body.style.marginRight="0px",document.body.style.overflow="visible",document.removeEventListener("keydown",t)}},[a]);let r=(0,n.jsx)(n.Fragment,{children:i?(0,n.jsx)("div",{className:b().mobileView,children:(0,n.jsx)(u,{...e})}):(0,n.jsx)("div",{className:b().desktopView,children:(0,n.jsx)(h,{...e})})});return t?(0,n.jsx)(d.A,{id:"modal",children:r}):r}},6897:(e,t,a)=>{"use strict";a.d(t,{$z:()=>y,CE:()=>r,ED:()=>x,H8:()=>b,HI:()=>i,K4:()=>_,Mt:()=>f,P3:()=>g,PJ:()=>S,QI:()=>s,SM:()=>c,Sx:()=>l,_C:()=>m,_k:()=>h,bX:()=>v,gZ:()=>w,jf:()=>p,kx:()=>d,nU:()=>u,r4:()=>o});var n=a(24001);let s={initial:"hidden",animate:"visible",exit:"out"},i={enter:{opacity:0,x:"100%",transition:{ease:"easeInOut"}},center:{opacity:1,x:"0%",transition:{ease:"easeInOut"}},exit:{opacity:0,x:"-50%",transition:{ease:"easeInOut"}}},r={variants:{show:{opacity:1},hide:{opacity:0}},transition:{duration:.5},initial:"hide",animate:"show",exit:"hide"},o={hidden:{opacity:0},visible:{opacity:1}},l={hidden:{opacity:0},visible:{opacity:1},out:{opacity:0}},u={hidden:{scale:0,opacity:0},visible:e=>({scale:[.5,1,.5,.5],opacity:[0,1,0,0],transition:{ease:"circInOut",duration:1.2,delay:.4*e,times:[0,.5,.9,1],repeat:1/0}})},d={hidden:{opacity:0},visible:{opacity:1},out:{opacity:0}},c={hidden:{width:0},visible:{width:"var(--panel-width)"},out:{width:0}},g={open:{width:288},closed:{width:64,transition:{delay:.1}}},p={open:{padding:"0px 15px",height:48},closed:{height:48,padding:"0px 15px"}},y={open:{opacity:1,width:"100%",marginLeft:8,display:"inline"},closed:{opacity:0,width:0,transitionEnd:{display:"none"}}},_={open:{marginRight:0},closed:{marginRight:0}},m={visible:{height:"auto",overflow:"hidden",transitionEnd:{overflow:"visible"}},hidden:{overflow:"hidden",height:0}},h={hidden:{opacity:.5},visible:{opacity:[1,.2,1],transition:{times:[0,.5,1],duration:1.5,repeat:1/0}}},v={hidden:e=>({backgroundColor:"#0A0A0A",transition:{duration:e.duration,delay:e.delay.hidden}}),visible:e=>({backgroundColor:"#FFFFFF",transition:{duration:e.duration,delay:e.delay.visible}})},f={hidden:e=>({transition:{duration:e.duration,delay:e.delay.hidden}}),visible:e=>({transition:{duration:e.duration,delay:e.delay.visible}})},b={hidden:{height:0,opacity:0},visible:{height:"auto",opacity:1},out:{height:0,opacity:0}},Q=[.3,.7,.5,1,.5,.7,.3],D=[.1,.2,.6,1.1,.6,.2,.1],M=[.1,.3,.8,.7,.8,.3,.1],w={paused:e=>({scaleY:[.3,.7,.5,1,.5,.7,.3][e]}),playing:e=>({scaleY:[Q[e],D[e]+(0,n.G0)(.1,.3),M[e]+(0,n.G0)(.1,.3),Q[e]],transition:{times:[0,.33,.66,1],duration:.8,repeat:1/0,easings:["backInOut","anticipate","easeInOut"]}})},x={hidden:{opacity:0,translateY:44},visible:{opacity:1,translateY:0}},S={visible:{y:[0,20,0,-20,0,-20,0,20],transition:{duration:16,ease:["easeInOut","easeOut","linear"][Math.floor(3*Math.random())],repeat:1/0,repeatType:"mirror"}}}},16736:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>r,DP:()=>u,Pj:()=>i,YJ:()=>g,YO:()=>l,nc:()=>o,yN:()=>c});var n=a(472),s=a(46786);let i=(0,n.vt)(e=>({fingerprint:"",setFingerprint:t=>e({fingerprint:t}),isCreditModalOpen:!1,toggleCreditModal:t=>e({isCreditModalOpen:t}),isLandingRateLimitModalOpen:!1,toggleLandingRateLimitModal:t=>e({isLandingRateLimitModalOpen:t}),isDarkMode:!1,setIsDarkMode:t=>e({isDarkMode:t}),showLandingSlider:!1,setShowLandingSlider:t=>e({showLandingSlider:t}),lastLandingCard:"",setLastLandingCard:t=>e({lastLandingCard:t}),isMounted:!1,setIsMounted:t=>e({isMounted:t}),isReferralRegisterModalOpen:!1,setIsReferralRegisterModalOpen:t=>e({isReferralRegisterModalOpen:t})})),r=i;(0,n.vt)(e=>({isLandingCardView:!0,setIsLandingCardView:t=>e({isLandingCardView:t})})),(0,n.vt)(e=>({isExploreThreeD:!1,setIsExploreThreeD:t=>e({isExploreThreeD:t})}));let o=(0,n.vt)(e=>({status:"loading",setStatus:t=>e({status:t})})),l=(0,n.vt)()((0,s.Zr)(e=>({code:"",setCode:t=>{e(e=>({code:e.code||t}))},clearCode:()=>e({code:""})}),{name:"referral"}));(0,n.vt)((e,t)=>({preview:null,setPreview:a=>{let{timeoutId:n}=t();n&&clearTimeout(n);let s=setTimeout(()=>{e({preview:null,timeoutId:null})},1e4);e({preview:a,timeoutId:s})},clearPreview:()=>{let{timeoutId:a}=t();a&&clearTimeout(a),e({preview:null,timeoutId:null})},timeoutId:null}));let u=(0,n.vt)()((0,s.Zr)(e=>({theme:"light",setTheme:t=>{e({theme:t})}}),{name:"chat-bubble-theme"})),d="this feature",c=(0,n.vt)(e=>({title:d,isSubscriptionModalOpen:!1,setSubscriptionModal:t=>e({...t,title:t.title||d})})),g=(0,n.vt)()((0,s.Zr)(e=>({isStreamingEnabled:!0,setIsStreamingEnabled:t=>e({isStreamingEnabled:t})}),{name:"streaming"}))},19407:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var n=a(12115),s=a(47650);let i=e=>{let{id:t,children:a}=e,[i,r]=(0,n.useState)();return((0,n.useLayoutEffect)(()=>{let e=document.getElementById(t);e&&r(e)},[t]),i)?(0,s.createPortal)(a,i):null}},72689:(e,t,a)=>{"use strict";a.d(t,{AD:()=>q,DM:()=>K,F0:()=>M,FC:()=>N,GX:()=>E,Hh:()=>Q,K9:()=>x,W0:()=>D,W5:()=>A,Xq:()=>w,ck:()=>S,n_:()=>I,ol:()=>C,pc:()=>j,q5:()=>P,ub:()=>L,yd:()=>k,zn:()=>F});var n=a(95838),s=a(48822),i=a(5041),r=a(84197),o=a(26715),l=a(74532),u=a(35695),d=a(91959),c=a.n(d),g=a(92957),p=a(9136),y=a(12115),_=a(7303),m=a(41068),h=a(18668),v=a(31530);let f=BigInt(0),b=BigInt(0),Q=()=>{let e=(0,o.useQueryClient)(),{updateLastMessage:t}=(0,h.Tl)(),a=(0,y.useMemo)(()=>c()(e=>v.Ay.success(e),1e3,{leading:!0,trailing:!1}),[]);(0,y.useEffect)(()=>(0,p.zj)("message",n=>{m.g.add(async()=>{let s=await e.fetchQuery({queryKey:["user"],queryFn:r.DL.userProfile}),i=e.getQueryData(["gp-chat",n.conversation_id]);if(!i)return;let o=await e.fetchQuery({queryKey:["conversation",n.conversation_id,"details"],queryFn:async()=>(0,h.SK)(n.conversation_id)}),l=null==i?void 0:i.pages.flat().find(e=>e.message_id<BigInt(0)),u=null==o?void 0:o.personas.find(e=>e.slug===n.author_slug),d=(0,_.ei)(o),c=n.editor_name;"deleted"===n.status&&d&&a("".concat(c," deleted a message")),"regenerated"===n.status&&d&&a("".concat(c," regenerated a message")),"user_changed"===n.status&&d&&a("".concat(c," changed a message")),(!l||(null==u?void 0:u.user_slug)!==s.slug)&&(e.setQueryData(["gp-chat",n.conversation_id,"status"],"completed"),e.setQueryData(["gp-chat",n.conversation_id],e=>{if(!e)return e;if("deleted"===n.status)return{...e,pages:e.pages.map(e=>e.filter(e=>e.message_id!==n.message_id))};let a=!1,s=e.pages.map(e=>e.map(e=>{if(e.message_id===n.message_id){a=!0;let t={};if(d){let e=n.metadata&&JSON.parse(n.metadata),a=(0,_.fi)(e,n.content||"");t={...n,metadata:e,regenerateIndex:a}}return{...e,...t,streamingStatus:"completed"}}return e}));return a||(t({conversation_id:n.conversation_id,content:n.content,timestamp:n.timestamp}),s=[[{...n,streamingStatus:"completed",metadata:{},regenerateIndex:0},...s[0]],...s.slice(1)]),{...e,pages:s}}),(null==o?void 0:o.objective)&&setTimeout(()=>{e.refetchQueries({exact:!0,queryKey:["conversation",n.conversation_id,"details"]})},3e3))})}),[a,e,t])},D=()=>{let e=(0,o.useQueryClient)();(0,y.useEffect)(()=>(0,p.zj)("begin_typing",t=>{m.g.add(async()=>{let a=await e.fetchQuery({queryKey:["conversation",t.conversation_id,"details"],queryFn:async()=>(0,h.SK)(t.conversation_id)});e.setQueryData(["gp-chat",t.conversation_id,"status"],a.isMultiUser?"pending":"typing")})}),[e])},M=()=>{let e=(0,o.useQueryClient)(),t=(0,u.useRouter)();(0,y.useEffect)(()=>(0,p.zj)("create_conversation",a=>{m.g.add(()=>{let n=(0,_.jE)(a.conversation),s=(0,_.ei)(a.conversation);e.setQueryData(["conversation",a.conversation.conversation_id,"details"],{...a.conversation,isMulti:n,isMultiUser:s}),e.setQueryData(["conversation-listing"],e=>{if(e)return[{conversation:{...a.conversation,isMulti:n,isMultiUser:s},message:{content:"",content_type:"text",message_id:BigInt(0),author_type:"llm",author_slug:"",status:"created",timestamp:new Date().toISOString(),author_name:"",conversation_id:a.conversation.conversation_id}},...e]}),e.setQueryData(["gp-chat",a.conversation.conversation_id],{pages:[[]],pageParams:[0]}),e.setQueryData(["gp-chat",a.conversation.conversation_id,"status"],s||a.conversation.greeting?"pending":"typing"),t.push("/chats/gp/".concat(a.conversation.conversation_id))})}))},w=e=>{let t="completed";return(0,n.useQuery)({queryKey:["gp-chat",e,"status"],initialData:t,queryFn:()=>t})},x=()=>{let e=(0,o.useQueryClient)();(0,y.useEffect)(()=>(0,p.zj)("begin_message",t=>{m.g.add(async()=>{let a="regenerated"===t.status;(await e.fetchQuery({queryKey:["conversation",t.conversation_id,"details"],queryFn:async()=>(0,h.SK)(t.conversation_id)})).isMultiUser||e.setQueryData(["gp-chat",t.conversation_id],e=>{if(e)return(0,l.jM)(e,e=>{if(a){e:for(let a of e.pages)for(let e of a)if(e.message_id===t.message_id){if("string"!=typeof e.content)return;e.metadata||(e.metadata={}),Array.isArray(e.metadata.alternative_regenerations)||(e.metadata.alternative_regenerations=[e.content]),e.metadata.alternative_regenerations.push("");break e}}else{var n;null==(n=e.pages[0])||n.unshift({content:"",content_type:"text",message_id:t.message_id,author_type:"llm",author_slug:t.authored_by,status:"created",timestamp:new Date().toISOString(),author_name:"",conversation_id:t.conversation_id,streamingStatus:"typing",regenerateIndex:0})}})})})}),[e])},S=()=>{let e=(0,o.useQueryClient)();(0,y.useEffect)(()=>(0,p.zj)("partial_message",t=>{m.g.add(async()=>{if((await e.fetchQuery({queryKey:["conversation",t.conversation_id,"details"],queryFn:async()=>(0,h.SK)(t.conversation_id)})).isMultiUser)return;e.setQueryData(["gp-chat",t.conversation_id,"status"],"streaming");let a="regenerated"===t.status;e.setQueryData(["gp-chat",t.conversation_id],e=>{if(!e)return;let n=e.pages.map(e=>e.map(e=>{if(e.message_id===t.message_id){let n={...e};if(a){n.metadata=n.metadata?{...n.metadata}:{},Array.isArray(n.metadata.alternative_regenerations)?n.metadata.alternative_regenerations=[...n.metadata.alternative_regenerations]:n.metadata.alternative_regenerations=[];let e=n.metadata.alternative_regenerations.length-1;e>=0&&t.content&&(n.metadata.alternative_regenerations[e]=t.content)}return null!==t.content&&(n.content=t.content),n.streamingStatus="streaming",n}return e}));return{...e,pages:n}})})}),[e])},k=()=>{let e=(0,o.useQueryClient)(),{updateLastMessage:t}=(0,h.Tl)();(0,y.useEffect)(()=>(0,p.zj)("end_message",a=>{m.g.add(()=>{e.setQueryData(["gp-chat",a.conversation_id,"status"],"completed"),e.setQueryData(["gp-chat",a.conversation_id],e=>{if(!e)return;let t=e.pages.map(e=>e.map(e=>e.message_id===a.message_id?{...e,streamingStatus:"completed"}:e));return{...e,pages:t}});let n=e.getQueryData(["gp-chat",a.conversation_id]),s=null==n?void 0:n.pages.flat().find(e=>e.message_id===a.message_id);s&&t(s)})}),[e,t])},I=e=>(0,s.useInfiniteQuery)({queryKey:["gp-chat",e],refetchOnWindowFocus:"always",queryFn:async t=>{let{pageParam:a}=t;return await m.g.add(async()=>(await (0,p.X6)("chat_history",{conversation_id:e,listing_query:{limit:25,cursor:a?a.toString():null}})).history.map(e=>{let t=e.metadata&&JSON.parse(e.metadata),a=(0,_.fi)(t,e.content||"");return{...e,metadata:e.metadata&&JSON.parse(e.metadata),streamingStatus:"completed",regenerateIndex:a}}))||[]},initialPageParam:BigInt(0),getNextPageParam:e=>{if(e.length<25)return;let t=e.at(-1);if(!t)return;let{message_id:a}=t;if(a>0)return a},throwOnError:!0,structuralSharing:!1}),j=()=>(0,i.useMutation)({mutationFn:e=>(0,p.X6)("create_conversation",e)}),C=e=>{let t=(0,o.useQueryClient)();return(0,i.useMutation)({mutationFn:a=>{let n=t.getQueryData(["gp-chat",e]),s=null==n?void 0:n.pages.flat().find(e=>"llm"===e.author_type);return(0,p.X6)("request_llm_message",{conversation_id:e,xoul_slug:a||(null==s?void 0:s.author_slug)||""})},onMutate:async()=>{let a=t.getQueryData(["gp-chat",e]),n=t.getQueryData(["gp-chat",e,"status"]),s=await t.fetchQuery({queryKey:["conversation",e,"details"],queryFn:async()=>(0,h.SK)(e)});return t.setQueryData(["gp-chat",e,"status"],s.isMultiUser?"pending":"typing"),{snapshot:n,historySnapshot:a}},onError:async(a,n,s)=>{m.g.add(()=>{(null==s?void 0:s.historySnapshot)&&t.setQueryData(["gp-chat",e],s.historySnapshot),(null==s?void 0:s.snapshot)&&t.setQueryData(["gp-chat",e,"status"],s.snapshot)})}})},q=()=>{let e=(0,o.useQueryClient)();return(0,i.useMutation)({mutationFn:e=>(0,p.X6)("update_conversation",e),onSuccess:async(t,a)=>{let n=await e.fetchQuery({queryKey:["asset",a.lorebook_slug],queryFn:async()=>a.lorebook_slug?await r.IC.assetRead(a.lorebook_slug):null});e.setQueryData(["conversation",a.conversation_id,"details"],e=>{if(e)return(0,l.jM)(e,t=>{var s,i,r,o,l,u,d;a.xoul_participant_talkativeness&&t.xouls.forEach(e=>{var t,n;e.talkativeness=null!=(n=null==(t=a.xoul_participant_talkativeness)?void 0:t[e.slug])?n:e.talkativeness}),t.audio_autoplay=null!=(s=a.audio_autoplay)?s:e.audio_autoplay,t.narrate=null!=(i=a.narrate)?i:e.narrate,t.auto_respond=null!=(r=a.auto_respond)?r:e.auto_respond,t.icon_url=null!=(o=a.icon_url)?o:e.icon_url,t.narrator_voice=null!=(l=a.narrator_voice)?l:e.narrator_voice,t.talking_style=null!=(u=a.talking_style)?u:e.talking_style,t.llm_engine=null!=(d=a.llm_engine)?d:e.llm_engine,t.lorebook_slug=a.lorebook_slug,t.lorebook=n?{asset_type:n.asset_type,creator_slug:n.creator_slug,description:n.description,name:n.name,slug:n.slug,icon_url:n.icon_url}:null})}),a.icon_url&&e.setQueryData(["conversation-listing"],e=>{if(e)return(0,l.jM)(e,e=>{let t=e.find(e=>e.conversation.conversation_id===a.conversation_id);t&&a.icon_url&&(t.conversation.icon_url=a.icon_url)})})}})},E=e=>{let t=(0,o.useQueryClient)();return(0,i.useMutation)({mutationFn:async a=>{let{message:n,requested_xouls:s}=a,i=await t.fetchQuery({queryKey:["conversation",e,"details"],queryFn:async()=>(0,h.SK)(e)});return(0,p.X6)("message_request",{conversation_id:e,user_message:n,requested_xouls:s,stream:!i.isMultiUser})},onMutate:async a=>{var n;b-=BigInt(1),await t.cancelQueries({queryKey:["gp-chat",e]});let s=t.getQueryData(["gp-chat",e]),i=await t.fetchQuery({queryKey:["user"],queryFn:r.DL.userProfile}),o=await t.fetchQuery({queryKey:["conversation",e,"details"],queryFn:async()=>(0,h.SK)(e)}),u=(null==o||null==(n=o.personas.find(e=>e.user_slug===i.slug))?void 0:n.slug)||"TEMP";t.setQueryData(["gp-chat",e],t=>{if(t)return(0,l.jM)(t,t=>{t.pages[0].unshift({message_id:b,conversation_id:e,timestamp:new Date().toISOString(),status:"created",author_slug:u,author_type:"user",author_name:"",content_type:"text",content:a.message,streamingStatus:"completed",regenerateIndex:0})})});let d=t.getQueryData(["gp-chat",e,"status"]);return(null==o?void 0:o.auto_respond)&&(t.setQueryData(["gp-chat",e,"status"],"pending"),o.isMultiUser||setTimeout(()=>{t.setQueryData(["gp-chat",e,"status"],e=>"pending"===e?"typing":e)},1e3)),{snapshot:s,statusSnapshot:d,lastTempId:b}},onSuccess:(a,n,s)=>{m.g.add(()=>{t.setQueryData(["gp-chat",a.conversation_id],e=>{if(!e)return;let t=e.pages.map(e=>e.map(e=>e.message_id===s.lastTempId?{...a,metadata:{alternative_regenerations:[]},streamingStatus:"completed",regenerateIndex:0}:(f-=BigInt(1),e)));return{...e,pages:t}});let n=t.getQueryData(["conversation",e,"details"]);(null==n?void 0:n.objective)&&setTimeout(()=>{t.refetchQueries({exact:!0,queryKey:["conversation",e,"details"]})},3e3);let i=t.getQueryData(["gp-chat",e]),r=null==i?void 0:i.pages[0][0];t.setQueryData(["conversation-listing"],t=>{if(t&&r)return(0,l.jM)(t,t=>{let a=t.find(t=>t.conversation.conversation_id===e);a&&r.timestamp&&(a.message.content=r.content,a.message.timestamp=r.timestamp),t.sort((e,t)=>e.message.timestamp&&t.message.timestamp?(0,g.T)(e.message.timestamp,t.message.timestamp):0)})})})},onError:async(a,n,s)=>{m.g.add(()=>{(null==s?void 0:s.snapshot)&&t.setQueryData(["gp-chat",e],null==s?void 0:s.snapshot),(null==s?void 0:s.statusSnapshot)&&t.setQueryData(["gp-chat",e,"status"],null==s?void 0:s.statusSnapshot)})}})},F=e=>{let t=(0,o.useQueryClient)(),{groupChatUpdateLastMessage:a}=O();return(0,i.useMutation)({mutationFn:t=>{let{content:a,message_id:n,metadata:s}=t;return(0,p.X6)("edit_message",{message:{action:"replace",conversation_id:e,message:a,message_id:n.toString(),metadata:s}})},onMutate:async a=>{let{content:n,message_id:s,metadata:i}=a;await t.cancelQueries({queryKey:["gp-chat",e]});let r=t.getQueryData(["gp-chat",e]);return t.setQueryData(["gp-chat",e],e=>{if(e)return(0,l.jM)(e,e=>{e.pages=e.pages.map(e=>e.map(e=>e.message_id===s?{...e,content:n,metadata:i}:e))})}),{snapshot:r}},onSuccess:()=>a(e),onError:(a,n,s)=>{m.g.add(()=>{(null==s?void 0:s.snapshot)&&t.setQueryData(["gp-chat",e],null==s?void 0:s.snapshot)})}})},K=e=>{let t=(0,o.useQueryClient)();return(0,i.useMutation)({mutationFn:t=>{let{message_id:a}=t;return(0,p.X6)("edit_message",{message:{action:"regenerate",conversation_id:e,message_id:a.toString()}})},onMutate:async a=>{let{message_id:n}=a;await t.cancelQueries({queryKey:["gp-chat",e]});let s=await t.fetchQuery({queryKey:["conversation",e,"details"],queryFn:async()=>(0,h.SK)(e)}),i=t.getQueryData(["gp-chat",e]);t.setQueryData(["gp-chat",e],e=>{if(!e)return;let t=e.pages.map(e=>e.map(e=>{if(e.message_id===n){let t={...e};return t.regenerateIndex++,t.streamingStatus="typing-regenerate",t}return e}));return{...e,pages:t}});let r=t.getQueryData(["gp-chat",e,"status"]);return t.setQueryData(["gp-chat",e,"status"],s.isMultiUser?"pending":"typing"),{historySnapshot:i,statusSnapshot:r}},onSuccess:()=>{let a=t.getQueryData(["conversation",e,"details"]);(null==a?void 0:a.objective)&&setTimeout(()=>{t.refetchQueries({exact:!0,queryKey:["conversation",e,"details"]})},3e3)},onError:(a,n,s)=>{m.g.add(()=>{(null==s?void 0:s.historySnapshot)&&t.setQueryData(["gp-chat",e],null==s?void 0:s.historySnapshot),(null==s?void 0:s.statusSnapshot)&&t.setQueryData(["gp-chat",e,"status"],null==s?void 0:s.statusSnapshot)})}})},N=e=>{let t=(0,o.useQueryClient)(),{groupChatUpdateLastMessage:a}=O();return(0,i.useMutation)({mutationFn:t=>{let{regenerations:a,message_id:n}=t;return(0,p.X6)("edit_message",{message:{action:"update_metadata",conversation_id:e,message_id:n.toString(),key:"alternative_regenerations",value:a}})},onMutate:async a=>{let{regenerations:n,message_id:s}=a;await t.cancelQueries({queryKey:["gp-chat",e]});let i=t.getQueryData(["gp-chat",e]);return t.setQueryData(["gp-chat",e],e=>{if(e)return(0,l.jM)(e,e=>{e:for(let t of e.pages)for(let e of t)if(e.message_id===s){e.metadata||(e.metadata={}),e.metadata.alternative_regenerations=n;break e}})}),{snapshot:i}},onError:(a,n,s)=>{m.g.add(()=>{(null==s?void 0:s.snapshot)&&t.setQueryData(["gp-chat",e],s.snapshot)})}})},L=e=>{let t=(0,o.useQueryClient)(),{groupChatUpdateLastMessage:a}=O();return(0,i.useMutation)({mutationFn:t=>{let{message_id:a}=t;return(0,p.X6)("edit_message",{message:{action:"delete",conversation_id:e,message_id:a.toString()}})},onMutate:async a=>{let{message_id:n}=a;await t.cancelQueries({queryKey:["gp-chat",e]});let s=t.getQueryData(["gp-chat",e]);return t.setQueryData(["gp-chat",e],e=>{if(e)return{...e,pages:e.pages.map(e=>e.filter(e=>e.message_id!==n))}}),{snapshot:s}},onSuccess:()=>a(e),onError:(a,n,s)=>{m.g.add(()=>{(null==s?void 0:s.snapshot)&&t.setQueryData(["gp-chat",e],s.snapshot)})}})},O=()=>{let e=(0,o.useQueryClient)(),{updateLastMessage:t}=(0,h.Tl)();return{groupChatUpdateLastMessage:(0,y.useCallback)(a=>{let n=e.getQueryData(["gp-chat",a]),s=null==n?void 0:n.pages[0][0];s&&t(s)},[e,t])}},A=e=>{let t=(0,o.useQueryClient)(),{groupChatUpdateLastMessage:a}=O();return(0,i.useMutation)({mutationFn:t=>{let{message_id:a}=t;return(0,p.X6)("edit_message",{message:{action:"rewind",conversation_id:e,message_id:a.toString()}})},onMutate:async a=>{let{message_id:n}=a;await t.cancelQueries({queryKey:["gp-chat",e]});let s=t.getQueryData(["gp-chat",e]);return t.setQueryData(["gp-chat",e],e=>{if(e)return{pageParams:[0],pages:[e.pages.flatMap(e=>e.filter(e=>e.message_id<=n))]}}),{snapshot:s}},onSuccess:()=>a(e),onError:(a,n,s)=>{m.g.add(()=>{(null==s?void 0:s.snapshot)&&t.setQueryData(["gp-chat",e],s.snapshot)})}})},P=e=>{let t=(0,o.useQueryClient)();return{updateRegenerateIndex:(0,y.useCallback)(a=>{let{message_id:n,index:s}=a;t.setQueryData(["gp-chat",e],e=>{if(!e)return e;let t=e.pages.map(e=>e.map(e=>e.message_id===n?{...e,regenerateIndex:s}:e));return{...e,pages:t}})},[t,e])}}},81167:(e,t,a)=>{"use strict";a.d(t,{$Z:()=>i,Ub:()=>s,oM:()=>o,rp:()=>r});var n=a(12115);function s(e){let[t,a]=(0,n.useState)();return(0,n.useEffect)(()=>{let t=window.matchMedia(e);a(t.matches);let n=()=>{a(t.matches)};return"function"==typeof t.addEventListener?t.addEventListener("change",n):t.addListener(n),()=>{"function"==typeof t.removeEventListener?t.removeEventListener("change",n):t.removeListener(n)}},[e]),t}let i="(max-width: 480px)",r="(min-width: 1025px)",o="(max-width: 768px)"},82882:e=>{e.exports={overlay:"MobileSheet_overlay__vHund",handle:"MobileSheet_handle__fvO1C",main:"MobileSheet_main__oJW5F",content:"MobileSheet_content__KBur8",nopadding:"MobileSheet_nopadding__YGzwJ",header:"MobileSheet_header__tNoFi",title:"MobileSheet_title__aIBGV","close-button":"MobileSheet_close-button__Ny49g",left_aligned_header:"MobileSheet_left_aligned_header__JdUnH",left_aligned_header_right:"MobileSheet_left_aligned_header_right__pB2mZ",buttons:"MobileSheet_buttons__VHPih",border:"MobileSheet_border__2NFsX"}},84700:e=>{e.exports={mobileView:"AdaptiveModal_mobileView__3N_rn",desktopView:"AdaptiveModal_desktopView__JHeJ3"}},97078:e=>{e.exports={overlay:"DesktopModal_overlay__fvxcY",modal:"DesktopModal_modal__zyXFP",modal_left_header:"DesktopModal_modal_left_header__iacIc",header:"DesktopModal_header___I7ht",title:"DesktopModal_title__9ezfb","close-button":"DesktopModal_close-button__qNDf8",left_aligned_header:"DesktopModal_left_aligned_header__TL8xG",buttons:"DesktopModal_buttons__9QKoI",content:"DesktopModal_content__PSw7c",nopadding:"DesktopModal_nopadding__hroTX",border:"DesktopModal_border___11na"}}}]);